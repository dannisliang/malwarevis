using UnityEngine;
using System.Collections;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
//using System.Threading.Tasks;
using Renci.SshNet;
using System.IO;

public class Send_Command7: MonoBehaviour {

	// Use this for initialization
	public void Send () {

		string address = "10.211.55.4";
		string user = "parallels";
		string pass = "Austinv0me6fp8";
		//string cmd = "r2 '/home/parallels/Desktop/Bomb.ex_' -c 'aa;s section..text;pdf;pdi;e asm.lines=False;e asm.comments=False;e asm.calls=false;e asm.cmtflgrefs=false;e asm.cmtright=false;e asm.flags=false;e asm.function=false;e asm.functions=false;e asm.vars=false;e asm.xrefs=false;e asm.linesout=false;e asm.fcnlines=false;e asm.fcncalls=false;e asm.demangle=false;aa;s 0x4011b0; afn phase2; pdf>main.txt;exit' -q";
		string cmd = "r2 '/home/parallels/Desktop/Bomb.ex_' -c 'aa; s 0x401460; afn phase6; fr phase6; pdf @ phase6 > main.txt' -q";
		string uploadfile = @"/Users/JonathanWatts/Desktop/Bomb.ex_";
		string uploadDirectory = "/home/parallels/Desktop/";
		//Upload a file to a linux VM
		using (var sftp = new SftpClient(address, user, pass))
		{
			try
			{
				sftp.Connect();
				using (var fileStream = new FileStream(uploadfile, FileMode.Open))
				{
					Console.WriteLine("Uploading {0} ({1:N0} bytes)",
						                  uploadfile, fileStream.Length);
					sftp.BufferSize = 4 * 1024; // bypass Payload error large files
					sftp.UploadFile(fileStream, uploadDirectory + Path.GetFileName(uploadfile));
				}
				sftp.Disconnect();
				sftp.Dispose();
			}
			catch(Exception ex)
			{
				Console.WriteLine(ex.Message);
			}
		}
			
			
		//This block of code will send linux terminal commands from windows machine to linux virtual machine
		using(SshClient client = new SshClient(address,user, pass))
		{
			try
			{
				client.Connect();
				var result = client.RunCommand(cmd);
				client.Disconnect();
				client.Dispose();
			}
			catch(Exception ex)
			{
				Console.WriteLine(ex.Message);
			}
		}
			
		//This block of code will download the file from linux VM to the windows host machine
		try
		{
			Debug.Log ("Uploading file...");
			using (var sftp = new SftpClient(address, user, pass))
			{
				sftp.Connect();
				if(File.Exists("/Users/JonathanWatts/main333.txt"))
				{
					File.Delete("/Users/JonathanWatts/main333.txt");
				}
				using (Stream file1 = File.OpenWrite("/Users/JonathanWatts/main333.txt"))
				{
					try
					{
							
						sftp.DownloadFile("main.txt", file1);
					}
					catch (Exception ex)
					{
						Console.WriteLine(ex.Message);
					}
					file1.Close();
						
				}
				sftp.Disconnect();
				sftp.Dispose();
			}
		}
		catch(Exception ex)
		{
			Debug.Log (ex.Message);
			Console.WriteLine(ex.Message);
		}
			
		//SshShell shell = new SshShell(address, user, pass);
	}

	// Update is called once per frame
	void Update () {
	
	}
}
